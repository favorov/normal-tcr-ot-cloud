# Project Context for GitHub Copilot

## Project Overview
TCR (T-cell receptor) analysis using Optimal Transport (Wasserstein distance) to compare probability distributions between patients.

## Key Scripts

### olga-p2p-ot.py
Calculates Wasserstein distance between two patient TSV files.

**Usage:**
```bash
python olga-p2p-ot.py <input_folder> <file1> <file2> <freq_column> <weights_column>
```

**Example:**
```bash
python olga-p2p-ot.py input/test-cloud-Tumeh2014 Patient01_Base_tcr_pgen.tsv Patient02_Base_tcr_pgen.tsv pgen duplicate_frequency_percent
```

**Without weights (uniform):**
```bash
python olga-p2p-ot.py input/test-cloud-Tumeh2014 Patient01_Base_tcr_pgen.tsv Patient02_Base_tcr_pgen.tsv pgen NO
```

## Mathematical Approach

### Distribution Model
- **Sample values**: The `pgen` column contains probability values (not frequencies)
- **Weights**: Each pgen value is weighted by the weight column (e.g., `duplicate_frequency_percent`)
- **Format**: Weighted empirical distribution
  - Each row is a sample point with its pgen value
  - Weight determines how much that sample contributes
  - If no weights specified: all weights = 1.0 (uniform)

### Wasserstein Distance
- Uses `scipy.stats.wasserstein_distance(values1, values2, u_weights=weights1, v_weights=weights2)`
- Measures "effort" to transform one distribution into another
- No smoothing applied - uses empirical distributions directly
- Preserves actual probability values without discretizing into bins

### Implementation Details
- Column parameters accept both:
  - Numeric indices (0-based): `0`, `1`, `2`
  - Column names from header: `pgen`, `duplicate_frequency_percent`
- Weight column can be disabled with: `NO`, `off`, `none`, `disabled`

## Environment Setup

### Python Environment
Using venv (Python 3.9.6):
```bash
# Create environment
python3 -m venv .venv

# Activate
source .venv/bin/activate

# Deactivate
deactivate
```

### Dependencies
- pandas
- scipy

## Data Structure
TSV files in `input/test-cloud-Tumeh2014/`:
- Patient01_Base_tcr_pgen.tsv through Patient25_Base_tcr_pgen.tsv
- Key columns:
  - `pgen`: Generation probability values (sample data)
  - `duplicate_frequency_percent`: Weights for each sample
  - Other metadata columns

## Design Decisions

### Why empirical distribution (no smoothing)?
- Many samples per patient
- pgen values are discrete observations
- Empirical Wasserstein is statistically sound as-is
- Could add KDE smoothing later if results are noisy

### Why weighted samples?
Interpretation: "I encountered pgen value X with weight W"
- Reflects how often each TCR sequence appears in the patient sample
- More frequent TCRs (higher duplicate_frequency_percent) contribute more to distribution

## Future Considerations
- Optional KDE smoothing parameter
- Batch processing for all patient pairs
- Output to CSV matrix
